# GTFS-RT Archiver Agency Configuration
# Copy this file to agencies.yaml and customize for your deployment.

# Default settings applied to all feeds unless overridden
defaults:
  timeout_seconds: 30
  retry:
    max_attempts: 3         # Number of retry attempts
    backoff_base: 1.0       # Initial backoff in seconds
    backoff_max: 10.0       # Maximum backoff in seconds
  # Per-feed-type interval defaults (in seconds)
  intervals:
    vehicle_positions: 20   # Real-time vehicle locations
    trip_updates: 20        # Predicted arrivals/departures
    service_alerts: 60      # Service disruption notices (change less frequently)

# Agency definitions
agencies:
  # Agency with multiple systems (bus vs rail)
  # This is the default example - no authentication required
  - id: septa
    name: SEPTA
    systems:
      - id: bus
        name: Bus
        schedule_url: https://www3.septa.org/developer/google_bus.zip
        feeds:
          - feed_type: vehicle_positions
            url: https://www3.septa.org/gtfsrt/septa-pa-us/Vehicle/rtVehiclePosition.pb
          - feed_type: trip_updates
            url: https://www3.septa.org/gtfsrt/septa-pa-us/Trip/rtTripUpdates.pb
          - feed_type: service_alerts
            url: https://www3.septa.org/gtfsrt/septa-pa-us/Service/rtServiceAlerts.pb

      - id: rail
        name: Regional Rail
        schedule_url: https://www3.septa.org/developer/google_rail.zip
        feeds:
          - feed_type: vehicle_positions
            url: https://www3.septa.org/gtfsrt/septarail-pa-us/Vehicle/rtVehiclePosition.pb
          - feed_type: trip_updates
            url: https://www3.septa.org/gtfsrt/septarail-pa-us/Trip/rtTripUpdates.pb
          - feed_type: service_alerts
            url: https://www3.septa.org/gtfsrt/septarail-pa-us/Service/rtServiceAlerts.pb

  # Example: Agency with header authentication and custom intervals
  # - id: metrolink
  #   name: Metrolink
  #   schedule_url: https://metrolinktrains.com/gtfs
  #   auth:
  #     type: header                    # Auth via HTTP header
  #     secret_name: metrolink-api-key  # Secret name in GCP Secret Manager
  #     key: X-Api-Key                  # Header name
  #   feeds:
  #     - feed_type: vehicle_positions
  #       url: https://metrolink-gtfsrt.gbsdigital.us/feed/gtfsrt-vehicles
  #       interval_seconds: 30          # Override default (20s)
  #     - feed_type: trip_updates
  #       url: https://metrolink-gtfsrt.gbsdigital.us/feed/gtfsrt-trips
  #       interval_seconds: 30          # Override default (20s)

  # Example: Agency with query parameter authentication and custom intervals
  # - id: actransit
  #   name: AC Transit
  #   schedule_url: https://api.actransit.org/transit/gtfs/download
  #   auth:
  #     type: query                     # Auth via query parameter
  #     secret_name: actransit-api-key  # Secret name in GCP Secret Manager
  #     key: token                      # Query parameter name
  #   feeds:
  #     - feed_type: vehicle_positions
  #       url: https://api.actransit.org/transit/gtfsrt/vehicles
  #       interval_seconds: 60          # Override default (20s)
  #     - feed_type: trip_updates
  #       url: https://api.actransit.org/transit/gtfsrt/tripupdates
  #       interval_seconds: 60          # Override default (20s)
  #     - feed_type: service_alerts
  #       url: https://api.actransit.org/transit/gtfsrt/alerts
  #       interval_seconds: 60          # Override default (60s)

  # Example: 511 API pattern (common for Bay Area agencies)
  # - id: vta
  #   name: Santa Clara VTA
  #   auth:
  #     type: query                     # Auth via query parameter
  #     secret_name: 511-api-key        # Shared secret for 511 API
  #     key: api_key                    # Query parameter name
  #   feeds:
  #     - feed_type: vehicle_positions
  #       url: https://api.511.org/transit/vehiclepositions?agency=SC
  #     - feed_type: trip_updates
  #       url: https://api.511.org/transit/tripupdates?agency=SC
  #     - feed_type: service_alerts
  #       url: https://api.511.org/transit/servicealerts?agency=SC

  # Example: Simple agency with HTTP feeds (no authentication)
  # Note: HTTP test caseâ€”this feed IS available over HTTPS too though
  # - id: bigbluebus
  #   name: Big Blue Bus
  #   feeds:
  #     - feed_type: vehicle_positions
  #       url: http://gtfs.bigbluebus.com/vehiclepositions.bin
  #     - feed_type: trip_updates
  #       url: http://gtfs.bigbluebus.com/tripupdates.bin
  #     - feed_type: service_alerts
  #       url: http://gtfs.bigbluebus.com/alerts.bin

  # Example: Agency with templated authentication (e.g., Bearer token)
  # Use ${SECRET} placeholder to embed the secret within a value
  # - id: example-bearer
  #   name: Example Bearer Auth Agency
  #   auth:
  #     type: header
  #     secret_name: example-token
  #     key: Authorization
  #     value: "Bearer ${SECRET}"     # ${SECRET} is replaced with the resolved secret
  #   feeds:
  #     - feed_type: vehicle_positions
  #       url: https://api.example.com/gtfs-rt/vehicles

  # Example: Per-feed authentication override
  # Feed-level auth overrides agency-level auth
  # - id: mixed-auth
  #   name: Mixed Auth Agency
  #   auth:
  #     type: header
  #     secret_name: agency-default-key
  #     key: x-api-key
  #   feeds:
  #     - feed_type: vehicle_positions
  #       url: https://api.example.com/vehicles
  #       # Uses agency auth (header: x-api-key)
  #     - feed_type: trip_updates
  #       url: https://api.example.com/trips
  #       auth:
  #         type: query
  #         secret_name: special-trips-key
  #         key: token
  #       # Overrides with feed-specific query auth
